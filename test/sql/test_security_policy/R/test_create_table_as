-- name: test_create_table_as
CREATE DATABASE test_create_table_as;
-- result:
-- !result
use test_create_table_as;
-- result:
-- !result
CREATE TABLE `t0` (
  `v1` bigint(20) NULL COMMENT "",
  `v2` bigint(20) NULL COMMENT ""
) ENGINE=OLAP
DUPLICATE KEY(`v1`, `v2`)
DISTRIBUTED BY RANDOM
PROPERTIES (
"replication_num" = "1",
"in_memory" = "false",
"enable_persistent_index" = "false",
"replicated_storage" = "true",
"compression" = "LZ4"
);
-- result:
-- !result
insert into t0 values(1,2);
-- result:
-- !result
insert into t0 values(3,4);
-- result:
-- !result
insert into t0 values(5,6);
-- result:
-- !result
insert into t0 values(7,8);
-- result:
-- !result
create masking policy mp as ( v1 bigint) returns bigint -> v1 + 1;
-- result:
-- !result
alter table t0 modify column v1 set masking policy mp;
-- result:
-- !result
alter table t0 modify column v2 set masking policy mp;
-- result:
-- !result
create row access policy rp as (col bigint) returns boolean -> if (col=1 or col=3 or col=5, true, false);
-- result:
-- !result
create row access policy rp2 as (col bigint) returns boolean -> if (col=1 or col=5, true, false);
-- result:
-- !result
alter table t0 add row access policy rp on (v1);
-- result:
-- !result
alter table t0 add row access policy rp2 on (v1);
-- result:
-- !result
create table t1 properties("replication_num"="1") as select * from t0;
-- result:
-- !result
select * from t1 order by v1;
-- result:
2	3
6	7
-- !result
create view v as select * from t0;
-- result:
-- !result
select * from v order by v1;
-- result:
2	3
6	7
-- !result
alter view v modify column v1 set masking policy mp;
-- result:
-- !result
select * from v order by v1;
-- result:
3	3
7	7
-- !result
select * from t0,v order by t0.v1;
-- result:
2	3	3	3
2	3	7	7
6	7	3	3
6	7	7	7
-- !result